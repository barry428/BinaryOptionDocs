# 二元期权平台风险点整理

## 一、平台风险敞口管理

### 1.1 结算价格控制
**核心问题**: 是否需要人为控制结算价格

**平台风险场景**:
- 单边行情：大量用户押注同一方向且获胜，平台面临巨额赔付
- 极端行情：价格剧烈波动导致结算结果对平台极度不利
- 对冲失败：对冲仓位未能有效覆盖用户投注敞口

**控制策略**:

| 策略 | 描述 | 风险 | 建议 |
|------|------|------|------|
| 完全市场价 | 使用第三方交易所真实价格 | 平台承担全部市场风险 | 需配合完善的对冲机制 |
| 价格微调 | 在合理范围内微调结算价格 | 用户发现可能投诉 | 控制在价差范围内（如±0.01%） |
| 多源取价 | 多数据源取中间值/加权平均 | 较为隐蔽但有操作空间 | 推荐，兼顾公平性和可控性 |

**建议方案**:
1. **正常情况**: 使用BTSE Fixture真实价格，通过对冲管理风险
2. **极端情况**: 预设价格干预阈值，当平台敞口超过限额时触发
3. **干预方式**:
   - 选择对平台有利的数据源
   - 在bid/ask价差范围内选择有利价格
   - 使用"技术问题"延迟结算等待有利价格

### 1.2 赔率动态控制
**核心问题**: 根据实际下单情况动态调整赔率

**平台风险场景**:
- 单边投注过重：90%用户押UP，如果UP赢平台亏损巨大
- 大额单边订单：单个大户重仓一个方向
- 固定赔率导致长期亏损

**动态赔率策略**:

```
场景1: 投注平衡（UP:DOWN ≈ 50:50）
  → 维持标准赔率（如1.85:1.85）
  → 平台通过价差稳定盈利

场景2: 轻度失衡（UP:DOWN = 60:40）
  → UP赔率下调至1.80，DOWN赔率上调至1.90
  → 吸引资金流向DOWN方向

场景3: 严重失衡（UP:DOWN = 80:20）
  → UP赔率大幅下调至1.70，DOWN赔率上调至2.00
  → 或暂停接受UP方向新订单
  → 同时增加对冲仓位
```

**赔率计算公式**:
```
基础赔率 = Fixture赔率（来自BTSE）
调整系数 = f(UP投注额, DOWN投注额, 平台敞口限额)
最终赔率 = 基础赔率 × 调整系数

// 示例：根据投注比例调整
如果UP投注占比 > 60%:
  UP赔率 = 基础赔率 × (1 - (UP占比 - 0.5) × 调整因子)
  DOWN赔率 = 基础赔率 × (1 + (UP占比 - 0.5) × 调整因子)
```

**建议方案**:
1. **实时监控**: 每个轮次实时统计UP/DOWN投注比例
2. **分级调整**: 根据失衡程度分级调整赔率
3. **锁定机制**: 用户下单时锁定赔率，但新订单使用调整后赔率
4. **限额控制**: 单边投注达到限额时停止接单

### 1.3 综合风险敞口管理

**敞口计算**:
```
平台最大亏损(UP赢) = UP总投注 × UP平均赔率 - DOWN总投注
平台最大亏损(DOWN赢) = DOWN总投注 × DOWN平均赔率 - UP总投注
平台敞口 = MAX(上述两值, 0)
```

**敞口控制手段**:

| 手段 | 触发条件 | 操作 |
|------|----------|------|
| 赔率调整 | 敞口 > 阈值1 | 降低重仓方向赔率 |
| 限额控制 | 敞口 > 阈值2 | 停止接受重仓方向订单 |
| 增加对冲 | 敞口 > 阈值3 | 在BTSE增加对冲仓位 |
| 价格干预 | 敞口 > 阈值4(极端) | 结算价格选择 |

---

## 二、报价与数据源风险

### 2.1 数据源聚合策略
**核心问题**: 多个数据源如何聚合，异常如何处理

**数据源配置**:

| 优先级 | 数据源 | 用途 | 权重 |
|--------|--------|------|------|
| 1 | BTSE Fixture | 主结算源 | 100% |
| 2 | BTSE WebSocket | 实时展示 | - |
| 3 | Binance API | 备用/交叉验证 | 可选 |

**聚合方式选项**:
1. **单源优先**: 正常使用主源，故障时切换备源
2. **加权平均**: 多源价格加权（可调整权重控制结果）
3. **中位数**: 取多源中间值（抗异常但不易控制）

**平台有利策略**:
- 当需要干预时，选择对平台有利的数据源
- 预设多个数据源，根据情况选择报价

### 2.2 异常处理与应急

**异常类型与处理**:

| 异常类型 | 前端展示 | 后端处理 |
|----------|----------|----------|
| 数据延迟(<5s) | 显示最后价格 | 继续使用缓存 |
| 数据延迟(5-30s) | "数据更新中" | 切换备用源 |
| 数据不可用 | "系统维护" | 暂停下单，延迟结算 |
| 价格异常跳动 | 暂停展示 | 人工审核后结算 |

**应急预案**:
1. 数据源全部不可用 → 延迟结算，等待恢复
2. 结算时数据异常 → 使用最后有效价格或人工介入
3. 争议情况 → 保留原始数据记录，支持事后审计

---

## 三、资金与对账风险

### 3.1 对账体系

**对账维度**:

| 对账类型 | 内容 | 频率 | 目的 |
|----------|------|------|------|
| 全局对账 | 平台收入 vs 支出 vs 余额 | 每日 | 确保平台资金安全 |
| 用户对账 | 用户余额 vs 流水累计 | 实时 | 防止资金异常 |
| 订单对账 | 订单结算 vs 实际转账 | 每轮次 | 确保结算准确 |
| BTSE对账 | 本地记录 vs BTSE记录 | 每小时 | 确保转账一致 |
| 盈亏对账 | 平台盈亏 vs 预期盈亏 | 每日 | 验证风控效果 |

**对账公式**:
```
用户余额 = 初始 + 充值 - 提现 + 盈利 - 亏损 - 手续费
平台盈利 = 用户总亏损 + 手续费 - 用户总盈利 - 对冲成本
```

**异常处理**:
- 差异 < 0.01%: 自动调账 + 记录日志
- 差异 0.01%-1%: 告警 + 人工审核
- 差异 > 1%: 冻结操作 + 紧急排查

### 3.2 资金安全

**风险点与控制**:

| 风险 | 控制措施 |
|------|----------|
| 转账失败状态不一致 | 幂等设计 + 定时补偿 |
| 并发超额转出 | 数据库原子操作 |
| 结算资金不足 | 资金池预警 + 限额控制 |

---

## 四、业务风险控制

### 4.1 订单风控

**现有控制**:
- 轮次状态检查
- 单轮次下单限制
- 余额校验
- 用户风控统计

**建议补充**:
- **大额订单审核**: 超过阈值需二次确认或降低赔率
- **频率限制**: 防止API滥用和刷单
- **关联账户检测**: 防止多账户套利

### 4.2 用户风控

**风险用户类型**:
1. **套利者**: 利用系统漏洞或价格延迟套利
2. **职业玩家**: 长期稳定盈利的专业交易者
3. **多账户用户**: 通过多账户分散投注对冲

**控制策略**:
- 标记高风险用户，降低其赔率或限制投注额
- 检测异常盈利模式，触发人工审核
- 设备指纹+IP关联分析

---

## 五、监控告警

### 5.1 核心监控指标

| 指标 | 告警阈值 | 处理 |
|------|----------|------|
| 单轮次平台敞口 | > 设定限额 | 调整赔率/停止接单 |
| UP/DOWN投注比 | > 70:30 | 赔率调整告警 |
| 单用户单轮投注 | > 限额 | 限制继续下单 |
| 数据源延迟 | > 5秒 | 切换数据源 |
| 对账差异 | > 0.01% | 人工审核 |
| 日盈亏偏离 | 偏离预期>20% | 风控审核 |

### 5.2 实时仪表盘

建议开发风控仪表盘，实时显示：
- 当前轮次UP/DOWN投注额和比例
- 平台当前敞口和最大亏损
- 赔率调整建议
- 数据源状态
- 大额订单提醒

---

## 六、优先级建议

### 高优先级（立即实施）
1. **敞口实时监控**: 每轮次监控UP/DOWN比例和平台敞口
2. **赔率动态调整机制**: 根据投注情况自动调整赔率
3. **大额订单限制**: 单用户单轮次投注限额
4. **对账系统**: 每日自动对账

### 中优先级（1-2个月）
1. **多数据源聚合**: 配置备用数据源和切换机制
2. **风控仪表盘**: 实时监控平台风险状态
3. **用户风险标签**: 标记高风险用户并差异化处理
4. **价格干预机制**: 极端情况下的结算价格选择策略

### 低优先级（持续优化）
1. **AI风控模型**: 智能识别异常模式
2. **自动对冲优化**: 优化对冲时机和仓位
3. **套利检测**: 多账户关联分析

---

## 七、关键决策点

### Q1: 是否控制结算价格？
**建议**: 正常情况使用真实市场价格，但保留极端情况下的干预能力
- 通过多数据源配置，在合规范围内选择有利价格
- 干预需谨慎，避免用户发现导致信任危机

### Q2: 是否动态调整赔率？
**建议**: 是，根据投注情况动态调整
- 这是行业通用做法，用户普遍接受
- 关键是调整要及时、透明（可选择是否展示实时赔率变化）

### Q3: 如何平衡风控与用户体验？
**建议**:
- 优先使用赔率调整而非价格干预
- 对普通用户保持良好体验，对高风险用户差异化处理
- 建立完善的客诉处理机制

---

*文档版本: v1.1*
*最后更新: 2025-11-24*
