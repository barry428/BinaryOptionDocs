# Options Betting Fixture API - 参数详细说明

## 一、核心概念解释

### 1. Fixture（期权合约）
- **定义**：预先设定的期权合约，包含了所有交易条件
- **作用**：标准化的交易产品，用户只能选择已存在的fixture进行交易
- **生命周期**：创建 → 开放交易 → 到期结算 → 关闭

### 2. 期权基础概念

#### Option（期权）
- **定义**：赋予持有人在特定时间以特定价格买入或卖出标的资产的权利
- **二元期权特点**：只有两种结果 - 盈利固定金额或损失全部投资

#### Call Option（看涨期权）
- **定义**：预测标的资产价格会**上涨**超过行权价
- **盈利条件**：到期时价格 > 行权价
- **例子**：BTC现价50000，买入行权价51000的Call，如果到期时BTC>51000则盈利

#### Put Option（看跌期权）
- **定义**：预测标的资产价格会**下跌**低于行权价
- **盈利条件**：到期时价格 < 行权价
- **例子**：BTC现价50000，买入行权价49000的Put，如果到期时BTC<49000则盈利

## 二、API参数详解

### `/fixtures` 接口参数

#### 请求参数

| 参数 | 类型 | 说明 | 示例 |
|-----|------|------|------|
| **symbol** | string | 标的资产符号 | "BTCUSDT", "ETHUSDT" |
| | | • 交易对的标识符 | |
| | | • 决定了期权基于哪个资产 | |
| **includeExpiredAfter** | datetime | 包含此时间后过期的合约 | "2024-01-15T10:00:00Z" |
| | | • 可选参数 | |
| | | • 用于查看历史已结算的合约 | |
| | | • 不传则只返回当前活跃合约 | |

#### 响应参数

##### open数组（开放合约）

| 参数 | 类型 | 说明 | 示例 | 专业解释 |
|-----|------|------|------|----------|
| **expiration** | datetime | 到期时间 | "2024-01-15T12:00:00Z" | 期权自动结算的时间点，过了这个时间无法再交易 |
| **strike** | float | 行权价格 | 50000.00 | 判断输赢的价格基准线 |
| **side** | string | 期权类型 | "call" 或 "put" | 看涨或看跌 |
| **itm** | boolean | 是否价内 | true/false | **In The Money**的缩写，表示当前是否处于盈利状态 |
| **price** | float | 当前价格 | 0.65 | **范围0-1**，表示获胜概率 |
| | | | | • 0.65 = 65%概率获胜 |
| | | | | • 投资100元，价格0.65，需支付65元 |
| | | | | • 如果赢，获得100元（净赚35元） |
| | | | | • 如果输，损失65元 |
| **openInterest** | integer | 未平仓量 | 1500 | 当前持有该合约的总数量，反映市场活跃度 |

##### closed数组（已关闭合约）
- 参数同open数组
- 用于展示历史记录和结算结果

### `/newbet` 接口参数

#### 请求参数

| 参数 | 类型 | 说明 | 示例 | 使用场景 |
|-----|------|------|------|----------|
| **symbol** | string | 标的资产 | "BTCUSDT" | 选择哪个交易对 |
| **expiration** | datetime | 到期时间 | "2024-01-15T12:00:00Z" | 必须匹配现有fixture |
| **strike** | float | 行权价 | 50000.00 | 必须匹配现有fixture |
| **side** | string | 方向 | "call" 或 "put" | 看涨或看跌 |

#### 响应参数

| 参数 | 类型 | 说明 | 可能值 |
|-----|------|------|--------|
| **status** | string | 请求状态 | "ok": 下注成功<br>"error": 下注失败 |
| **message** | string | 详细信息 | "Order placed successfully"<br>"Fixture already expired"<br>"Insufficient balance" |

### WebSocket消息参数

#### Meta订阅（合约状态更新）

##### 订阅消息
```json
{
    "subscribe": "meta",  // 订阅类型：元数据更新
    "symbol": "BTCUSDT"   // 关注的交易对
}
```

##### 推送消息

| 参数 | 说明 |
|------|------|
| **type** | "meta" - 消息类型标识 |
| **opened** | 新创建的合约列表 |
| **closed** | 刚到期的合约列表 |
| | • 包含最终ITM状态 |
| | • 包含最终未平仓量 |

#### Tick订阅（价格更新）

##### 订阅消息
```json
{
    "subscribe": "tick",  // 订阅类型：价格数据
    "symbol": "BTCUSDT"   // 关注的交易对
}
```

##### 推送消息

| 参数 | 说明 | 更新频率 |
|------|------|----------|
| **type** | "tick" - 价格更新标识 | - |
| **fixtures** | 合约价格数组 | 实时 |
| **price** | 实时价格(0-1) | 随市场波动 |
| **itm** | 实时盈亏状态 | 价格穿越行权价时改变 |

## 三、专业术语详解

### ITM/OTM/ATM状态

| 状态 | 全称 | 中文 | Call期权条件 | Put期权条件 | 对用户的意义 |
|------|------|------|-------------|------------|--------------|
| **ITM** | In The Money | 价内 | 现价 > 行权价 | 现价 < 行权价 | 如果现在到期会盈利 |
| **OTM** | Out of The Money | 价外 | 现价 < 行权价 | 现价 > 行权价 | 如果现在到期会亏损 |
| **ATM** | At The Money | 平价 | 现价 = 行权价 | 现价 = 行权价 | 不赚不赔的临界点 |

### 价格计算逻辑

#### Price（价格）的含义
```
价格 = 获胜概率

影响因素：
1. 剩余时间：时间越短，价格越接近0或1
2. 现价与行权价的距离：距离越远，价格越偏离0.5
3. 波动率：波动越大，价格越接近0.5
4. 市场情绪：买入压力会推高价格
```

#### 实际交易示例
```
场景：BTC现价 = 50,000 USDT
合约：行权价 = 51,000，到期时间 = 1小时后，类型 = Call
价格：0.35（系统计算出35%概率会涨到51,000以上）

用户下注100 USDT：
- 实际支付：100 × 0.35 = 35 USDT
- 如果赢（BTC > 51,000）：获得100 USDT，净赚65 USDT
- 如果输（BTC ≤ 51,000）：损失35 USDT
- 预期收益率：65/35 = 185.7%
```

### Open Interest（未平仓量）

**定义**：当前所有未到期的该合约持仓总量

**作用**：
1. **流动性指标**：数值越大，说明越多人参与
2. **市场情绪**：Call的OI > Put的OI，说明市场看涨
3. **风险管理**：平台用于控制总体风险敞口

**计算方式**：
```
新用户买入 +1
用户平仓 -1
到期自动清零
```

## 四、业务流程示例

### 完整交易流程

```mermaid
sequenceDiagram
    participant User as 用户
    participant Client as 客户端
    participant API as Fixture API
    participant Market as 市场数据
    
    User->>Client: 1. 选择交易对(BTCUSDT)
    Client->>API: 2. GET /fixtures?symbol=BTCUSDT
    API-->>Client: 3. 返回可用合约列表
    
    Note over Client: 显示不同行权价和到期时间的期权
    
    User->>Client: 4. 选择: Call, Strike=51000, Exp=12:00
    Client->>Client: 5. 显示价格: 0.45 (45%胜率)
    User->>Client: 6. 确认投注100 USDT
    
    Client->>API: 7. POST /newbet
    API-->>Client: 8. 风控验证通过
    
    Client->>Client: 9. 扣款: 100 × 0.45 = 45 USDT
    
    Client->>API: 10. WS订阅: tick
    loop 价格更新
        Market->>API: 市场波动
        API->>Client: 推送新价格和ITM状态
        Client->>User: 显示实时盈亏
    end
    
    Note over API: 12:00 到期
    API->>Client: 11. 推送结算结果
    
    alt BTC > 51000 (赢)
        Client->>User: 12a. 入账100 USDT
    else BTC ≤ 51000 (输)
        Client->>User: 12b. 显示亏损45 USDT
    end
```

## 五、风险提示

1. **价格波动风险**：期权价格可能快速变化
2. **时间价值衰减**：越接近到期，时间价值越少
3. **全损风险**：二元期权可能损失全部投资
4. **流动性风险**：Open Interest低时可能难以成交

## 六、对接建议

1. **价格精度**：建议保留4位小数（0.0001）
2. **时间同步**：服务器时间必须精确同步
3. **缓存策略**：fixture列表可缓存1-5秒
4. **重连机制**：WebSocket断线需自动重连并重新订阅
5. **风控限制**：
   - 单笔最大投注额
   - 用户持仓上限
   - 到期前X秒停止交易