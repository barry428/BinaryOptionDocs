# AOP å®‰å…¨éªŒè¯æ¶æ„è®¾è®¡

## æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†æè¿°äº†äºŒå…ƒæœŸæƒäº¤æ˜“å¹³å°ä¸­åŸºäº AOPï¼ˆé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰çš„å®‰å…¨éªŒè¯æ¶æ„è®¾è®¡ï¼ŒåŒ…æ‹¬æŠ€æœ¯å®ç°ã€æ¶æ„å†³ç­–ã€ä½¿ç”¨æŒ‡å—å’Œæ‰©å±•æ–¹æ¡ˆã€‚

## ç›®å½•

1. [æ¶æ„æ¦‚è¿°](#æ¶æ„æ¦‚è¿°)
2. [æŠ€æœ¯å®ç°](#æŠ€æœ¯å®ç°)
3. [æ ¸å¿ƒç»„ä»¶](#æ ¸å¿ƒç»„ä»¶)
4. [å®‰å…¨é˜²æŠ¤èŒƒå›´](#å®‰å…¨é˜²æŠ¤èŒƒå›´)
5. [é…ç½®ä¸éƒ¨ç½²](#é…ç½®ä¸éƒ¨ç½²)
6. [æµ‹è¯•éªŒè¯](#æµ‹è¯•éªŒè¯)
7. [æ¶æ„å†³ç­–](#æ¶æ„å†³ç­–)
8. [æ€§èƒ½åˆ†æ](#æ€§èƒ½åˆ†æ)
9. [æ‰©å±•æ–¹æ¡ˆ](#æ‰©å±•æ–¹æ¡ˆ)
10. [ç»´æŠ¤æŒ‡å—](#ç»´æŠ¤æŒ‡å—)

## æ¶æ„æ¦‚è¿°

### è®¾è®¡ç†å¿µ

é‡‡ç”¨**åŒå±‚å®‰å…¨éªŒè¯æ¶æ„**ï¼Œé€šè¿‡ AOP åˆ‡é¢å’Œ Bean Validation æä¾›çºµæ·±é˜²å¾¡ï¼š

```
Client Request â†’ Gateway â†’ Microservice â†’ AOP Security â†’ Bean Validation â†’ Controller
```

### æ ¸å¿ƒä¼˜åŠ¿

- **è‡ªåŠ¨åŒ–ä¿æŠ¤**: æ‰€æœ‰æ–°æ¥å£è‡ªåŠ¨è·å¾—å®‰å…¨éªŒè¯
- **ç»Ÿä¸€ç®¡ç†**: å®‰å…¨è§„åˆ™é›†ä¸­ç»´æŠ¤ï¼Œé¿å…ä»£ç é‡å¤
- **ç±»å‹å®‰å…¨**: åŸºäº Java å¼ºç±»å‹ç³»ç»Ÿï¼ŒéªŒè¯æ›´ç²¾ç¡®
- **ä¸šåŠ¡ç›¸å…³**: å¯æ ¹æ®ä¸åŒä¸šåŠ¡åœºæ™¯å®šåˆ¶éªŒè¯è§„åˆ™
- **ä¸æ˜“é—æ¼**: å¼€å‘è€…æ— éœ€æ‰‹åŠ¨æ·»åŠ å®‰å…¨éªŒè¯è°ƒç”¨

## æŠ€æœ¯å®ç°

### å®ç°æ–¹å¼å¯¹æ¯”

| éªŒè¯å±‚çº§ | å®ç°æ–¹å¼ | è§¦å‘æ—¶æœº | éªŒè¯å†…å®¹ | çŠ¶æ€ç  |
|---------|----------|----------|----------|--------|
| **AOP Security** | åˆ‡é¢æ‹¦æˆª | Controller æ‰§è¡Œå‰ | SQLæ³¨å…¥ã€XSSæ”»å‡»ã€æ•°å€¼æº¢å‡º | 200 (ä¸šåŠ¡é”™è¯¯) |
| **Bean Validation** | æ³¨è§£éªŒè¯ | å‚æ•°ç»‘å®šæ—¶ | æ ¼å¼ã€èŒƒå›´ã€å¿…å¡«éªŒè¯ | 400 (å‚æ•°é”™è¯¯) |

### å¤„ç†æµç¨‹

```mermaid
graph TD
    A[Client Request] --> B[Gateway Routing]
    B --> C[Microservice Controller]
    C --> D{AOP Security Aspect}
    D -->|æ¶æ„è¾“å…¥| E[è¿”å›å®‰å…¨é”™è¯¯]
    D -->|æ­£å¸¸è¾“å…¥| F{Bean Validation}
    F -->|éªŒè¯å¤±è´¥| G[è¿”å›å‚æ•°é”™è¯¯]
    F -->|éªŒè¯é€šè¿‡| H[Controller Method]
    
    style D fill:#ff9999
    style F fill:#99ccff
    style E fill:#ffcccc
    style G fill:#ffcccc
```

## æ ¸å¿ƒç»„ä»¶

### 1. AOP å®‰å…¨åˆ‡é¢

**ä½ç½®**: `option-common-utils/src/main/java/com/binaryoption/commonutils/validation/SecurityValidationAspect.java`

**åŠŸèƒ½ç‰¹æ€§**:
- è‡ªåŠ¨æ‹¦æˆª `@PostMapping`, `@PutMapping`, `@RequestMapping` æ–¹æ³•
- æ™ºèƒ½è¯†åˆ« RequestDTO ç±»å‹ï¼ˆä»¥ `RequestDTO`, `CreateDTO`, `UpdateDTO` ç»“å°¾ï¼‰
- æ ¹æ®å­—æ®µç±»å‹å’Œåç§°æ‰§è¡Œç›¸åº”çš„å®‰å…¨éªŒè¯

**æ ¸å¿ƒæ–¹æ³•**:
```java
@Before("@annotation(org.springframework.web.bind.annotation.PostMapping) || " +
        "@annotation(org.springframework.web.bind.annotation.PutMapping) || " +
        "@annotation(org.springframework.web.bind.annotation.RequestMapping)")
public void validateInputSecurity(JoinPoint joinPoint)
```

### 2. å®‰å…¨éªŒè¯å·¥å…·ç±»

#### InputSecurityValidator
**ä½ç½®**: `option-common-utils/src/main/java/com/binaryoption/commonutils/validation/InputSecurityValidator.java`

**é˜²æŠ¤èƒ½åŠ›**:
- **SQL æ³¨å…¥æ£€æµ‹**: æ£€æµ‹ 27 ç§å¸¸è§ SQL æ³¨å…¥æ¨¡å¼
- **XSS æ”»å‡»æ£€æµ‹**: æ£€æµ‹ 15 ç§å¸¸è§ XSS æ”»å‡»æ¨¡å¼
- **è¾“å…¥é•¿åº¦é™åˆ¶**: é˜²æ­¢ç¼“å†²åŒºæº¢å‡ºæ”»å‡»
- **è¾“å…¥æ¸…ç†**: ç§»é™¤æ½œåœ¨å±é™©å­—ç¬¦

#### NumericSecurityValidator
**ä½ç½®**: `option-common-utils/src/main/java/com/binaryoption/commonutils/validation/NumericSecurityValidator.java`

**é˜²æŠ¤èƒ½åŠ›**:
- **Long ç±»å‹æº¢å‡º**: é˜²æ­¢è¾¹ç•Œå€¼æ”»å‡»
- **BigDecimal æº¢å‡º**: é˜²æ­¢è¶…å¤§æ•°å€¼æ”»å‡»
- **ç²¾åº¦æ”»å‡»**: é™åˆ¶å°æ•°ç²¾åº¦é˜²æ­¢æ€§èƒ½æ”»å‡»
- **ID å­—æ®µéªŒè¯**: ç¡®ä¿ ID ä¸ºæ­£æ•°ä¸”åœ¨å®‰å…¨èŒƒå›´å†…

### 3. Bean Validation æ³¨è§£

**ä½ç½®**: `option-common-dto/src/main/java/com/binaryoption/commondto/order/OrderCreateRequestDTO.java`

**éªŒè¯æ³¨è§£**:
```java
@NotNull(message = "Amount is required")
@DecimalMin(value = "0.01", message = "Amount cannot be less than 0.01")
@DecimalMax(value = "1000000.00", message = "Amount cannot exceed 1,000,000.00")
@Digits(integer = 7, fraction = 2, message = "Amount format is incorrect")
private BigDecimal amount;

@NotBlank(message = "Account type is required")
@Pattern(regexp = "^(DEMO|REAL)$", message = "Account type must be DEMO or REAL")
private String accountType;
```

## å®‰å…¨é˜²æŠ¤èŒƒå›´

### AOP å®‰å…¨éªŒè¯

| æ”»å‡»ç±»å‹ | æ£€æµ‹å­—æ®µ | æ£€æµ‹æ¨¡å¼ | ç¤ºä¾‹å¨èƒ |
|---------|----------|----------|----------|
| **SQL æ³¨å…¥** | `accountType`, `direction`, `status`, `symbol` | 27 ç§æ¨¡å¼ | `'; DROP TABLE users; --` |
| **XSS æ”»å‡»** | `userAgent`, `deviceId`, `description` | 15 ç§æ¨¡å¼ | `<script>alert('XSS')</script>` |
| **é•¿åº¦æ”»å‡»** | æ‰€æœ‰å­—ç¬¦ä¸²å­—æ®µ | åŠ¨æ€é•¿åº¦é™åˆ¶ | è¶…é•¿å­—ç¬¦ä¸²ç¼“å†²åŒºæº¢å‡º |
| **æ•°å€¼æº¢å‡º** | æ‰€æœ‰æ•°å€¼å­—æ®µ | è¾¹ç•Œå€¼æ£€æµ‹ | `Long.MAX_VALUE` |

### Bean Validation éªŒè¯

| éªŒè¯ç±»å‹ | åº”ç”¨å­—æ®µ | éªŒè¯è§„åˆ™ | é”™è¯¯å¤„ç† |
|---------|----------|----------|----------|
| **å¿…å¡«éªŒè¯** | æ ¸å¿ƒä¸šåŠ¡å­—æ®µ | `@NotNull`, `@NotBlank` | 400 çŠ¶æ€ç  |
| **èŒƒå›´éªŒè¯** | æ•°å€¼å­—æ®µ | `@Min`, `@Max`, `@DecimalMin` | å‚æ•°é”™è¯¯ |
| **æ ¼å¼éªŒè¯** | æšä¸¾å­—æ®µ | `@Pattern` | æ ¼å¼é”™è¯¯ |
| **ç²¾åº¦éªŒè¯** | é‡‘é¢å­—æ®µ | `@Digits` | ç²¾åº¦é”™è¯¯ |

## é…ç½®ä¸éƒ¨ç½²

### æœåŠ¡é…ç½®è¦æ±‚

æ¯ä¸ªä½¿ç”¨å®‰å…¨éªŒè¯çš„å¾®æœåŠ¡éœ€è¦æ»¡è¶³ä»¥ä¸‹é…ç½®ï¼š

1. **ä¾èµ–å¼•å…¥**
```xml
<dependency>
    <groupId>com.binaryoption</groupId>
    <artifactId>option-common-utils</artifactId>
</dependency>
```

2. **å¯ç”¨ AOP**
```java
@SpringBootApplication
@EnableAspectJAutoProxy
public class Application {
    // ...
}
```

3. **ç»„ä»¶æ‰«æ**
```java
@ComponentScan(basePackages = {
    "com.binaryoption.orderservice", 
    "com.binaryoption.commonutils"
})
```

4. **å®‰å…¨é…ç½®**
```java
@Configuration
@EnableWebSecurity
public class SecurityConfig extends BaseSecurityConfig {
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        // é…ç½®æµ‹è¯•æ¥å£å…è®¸è®¿é—®
        http.authorizeRequests()
            .antMatchers("/api/test/**").permitAll()
            .antMatchers("/api/**").authenticated();
        return http.build();
    }
}
```

### å·²é…ç½®æœåŠ¡

| æœåŠ¡å | ç«¯å£ | AOP çŠ¶æ€ | Bean Validation | å®‰å…¨é…ç½® |
|-------|------|----------|----------------|----------|
| **option-order-service** | 8082 | âœ… å·²å¯ç”¨ | âœ… å·²å¯ç”¨ | âœ… å·²é…ç½® |
| **option-common-service** | 8081 | âœ… å·²å¯ç”¨ | âœ… å·²å¯ç”¨ | âœ… å·²é…ç½® |
| **option-market-service** | 8083 | âœ… å·²å¯ç”¨ | âœ… å·²å¯ç”¨ | âœ… å·²é…ç½® |

### å›½é™…åŒ–é…ç½®

åœ¨å„æœåŠ¡çš„ `messages.properties` æ–‡ä»¶ä¸­æ·»åŠ å®‰å…¨é”™è¯¯æ¶ˆæ¯ï¼š

```properties
# Security validation messages
input.contains.sql.injection=Field {0} contains potential SQL injection
input.contains.xss.attack=Field {0} contains potential XSS attack
input.too.long=Field {0} exceeds maximum length of {1} characters
input.numeric.overflow=Field {0} contains numeric overflow
input.decimal.overflow=Field {0} contains decimal overflow
input.decimal.precision.too.high=Field {0} decimal precision is too high
input.id.must.positive=Field {0} must be a positive number
input.validation.error=Input security validation failed
```

## æµ‹è¯•éªŒè¯

### æµ‹è¯•å·¥å…·

#### 1. å®Œæ•´æµ‹è¯•å¥—ä»¶
**ä½ç½®**: `test-scripts/security_test_fixed.sh`
```bash
# è¿è¡Œæ‰€æœ‰å®‰å…¨æµ‹è¯•
./test-scripts/security_test_fixed.sh

# æµ‹è¯•ä¸åŒç«¯å£
./test-scripts/security_test_fixed.sh -u http://localhost:8080
```

#### 2. å•ç‚¹æµ‹è¯•å·¥å…·
**ä½ç½®**: `test-scripts/test_single_endpoint.sh`
```bash
# å¿«é€Ÿæµ‹è¯•å•ä¸ªç«¯ç‚¹
./test-scripts/test_single_endpoint.sh [port]
```

#### 3. æµ‹è¯•æ§åˆ¶å™¨
**ä½ç½®**: `option-order-service/.../SecurityTestController.java`
- æä¾›ä¸“ç”¨æµ‹è¯•ç«¯ç‚¹
- éªŒè¯ AOP åˆ‡é¢åŠŸèƒ½
- ä¸å¤„ç†ä¸šåŠ¡é€»è¾‘

### æµ‹è¯•è¦†ç›–

| æµ‹è¯•ç±»åˆ« | æµ‹è¯•æ•°é‡ | éªŒè¯å†…å®¹ | æœŸæœ›ç»“æœ |
|---------|----------|----------|----------|
| **AOP å®‰å…¨éªŒè¯** | 4 ä¸ª | SQLæ³¨å…¥ã€XSSæ”»å‡» | æ£€æµ‹å¹¶é˜»æ­¢ |
| **Bean Validation** | 5 ä¸ª | æ ¼å¼ã€èŒƒå›´ã€é•¿åº¦ | å‚æ•°éªŒè¯å¤±è´¥ |
| **æ­£å¸¸è¯·æ±‚** | 1 ä¸ª | ä¸šåŠ¡æµç¨‹ | æ­£å¸¸å¤„ç† |

### æµ‹è¯•ç»“æœç¤ºä¾‹

```bash
âœ… All tests passed: 10/10
âœ… ğŸ‰ Security validation is working correctly!
âœ…    - AOP Security Validation: 4 tests
âœ…    - Bean Validation: 5 tests

ğŸ›¡ï¸  Your application is protected against:
   âœ“ SQL Injection attacks (AOP)
   âœ“ XSS (Cross-Site Scripting) attacks (AOP)
   âœ“ Numeric overflow attacks (Bean)
   âœ“ Field length attacks (Bean)
   âœ“ Invalid data format (Bean)
```

## æ¶æ„å†³ç­–

### ä¸ºä»€ä¹ˆé€‰æ‹©å¾®æœåŠ¡å†…éƒ¨éªŒè¯ï¼Ÿ

#### å½“å‰æ¶æ„ï¼šå¾®æœåŠ¡å†…éƒ¨ AOP
**ä¼˜åŠ¿**:
- âœ… **ç±»å‹å®‰å…¨**: åŸºäºå¼ºç±»å‹ DTOï¼ŒéªŒè¯æ›´ç²¾ç¡®
- âœ… **ä¸šåŠ¡ç›¸å…³**: å¯æ ¹æ®ä¸šåŠ¡é€»è¾‘å®šåˆ¶éªŒè¯è§„åˆ™
- âœ… **æ€§èƒ½ä¼˜åŒ–**: åªéªŒè¯å¿…è¦å­—æ®µï¼Œé¿å…å…¨é‡è§£æ
- âœ… **ç»´æŠ¤ç®€å•**: éªŒè¯é€»è¾‘ä¸ä¸šåŠ¡é€»è¾‘åœ¨åŒä¸€æœåŠ¡
- âœ… **æ‰©å±•çµæ´»**: æ¯ä¸ªæœåŠ¡å¯ä»¥æœ‰ä¸åŒçš„éªŒè¯ç­–ç•¥

**åŠ£åŠ¿**:
- âŒ **ä»£ç åˆ†æ•£**: æ¯ä¸ªæœåŠ¡éƒ½éœ€è¦é…ç½®
- âŒ **èµ„æºå ç”¨**: æ¯ä¸ªæœåŠ¡éƒ½è¦æ‰§è¡ŒéªŒè¯é€»è¾‘

#### å¤‡é€‰æ–¹æ¡ˆï¼šç½‘å…³å±‚éªŒè¯
**ä¼˜åŠ¿**:
- âœ… **é›†ä¸­ç®¡ç†**: æ‰€æœ‰éªŒè¯è§„åˆ™åœ¨ç½‘å…³ç»Ÿä¸€ç®¡ç†
- âœ… **å‡å°‘è´Ÿè½½**: æ¶æ„è¯·æ±‚åœ¨ç½‘å…³å°±è¢«æ‹¦æˆª
- âœ… **ç»Ÿä¸€é…ç½®**: ä¸€æ¬¡é…ç½®ï¼Œæ‰€æœ‰æœåŠ¡å—ä¿æŠ¤

**åŠ£åŠ¿**:
- âŒ **é€šç”¨æ€§é™åˆ¶**: æ— æ³•äº†è§£æ¯ä¸ªæœåŠ¡çš„å…·ä½“ DTO ç»“æ„
- âŒ **æ€§èƒ½å¼€é”€**: éœ€è¦è§£ææ‰€æœ‰ JSON å†…å®¹
- âŒ **ç»´æŠ¤å¤æ‚**: ç½‘å…³éœ€è¦äº†è§£æ‰€æœ‰æœåŠ¡çš„éªŒè¯è§„åˆ™
- âŒ **ç±»å‹ä¸¢å¤±**: ç¼ºä¹å¼ºç±»å‹æ£€æŸ¥

### å†³ç­–ç»“è®º

é€‰æ‹©**å¾®æœåŠ¡å†…éƒ¨ AOP éªŒè¯**çš„åŸå› ï¼š

1. **æ›´é«˜çš„å®‰å…¨æ€§**: åŸºäºå¼ºç±»å‹ç³»ç»Ÿï¼ŒéªŒè¯æ›´ç²¾ç¡®å¯é 
2. **æ›´å¥½çš„å¯ç»´æŠ¤æ€§**: éªŒè¯é€»è¾‘ä¸ä¸šåŠ¡é€»è¾‘ç´§å¯†ç»“åˆ
3. **æ›´å¼ºçš„æ‰©å±•æ€§**: æ”¯æŒä¸šåŠ¡ç›¸å…³çš„å¤æ‚éªŒè¯è§„åˆ™
4. **æ›´ä¼˜çš„æ€§èƒ½**: é¿å…ä¸å¿…è¦çš„å…¨é‡æ•°æ®è§£æ

## æ€§èƒ½åˆ†æ

### æ€§èƒ½æŒ‡æ ‡

| éªŒè¯ç»„ä»¶ | å¹³å‡è€—æ—¶ | å†…å­˜å ç”¨ | CPU å½±å“ | å¹¶å‘æ”¯æŒ |
|---------|----------|----------|----------|----------|
| **AOP åˆ‡é¢** | < 1ms | æå° | < 1% | é«˜ |
| **å®‰å…¨éªŒè¯** | < 0.5ms | æå° | < 0.5% | é«˜ |
| **Bean Validation** | < 0.2ms | æå° | < 0.3% | é«˜ |

### æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

1. **æ™ºèƒ½å­—æ®µè¯†åˆ«**: åªå¯¹å¿…è¦å­—æ®µæ‰§è¡ŒéªŒè¯
2. **ç¼–è¯‘æ—¶ä¼˜åŒ–**: ä½¿ç”¨ç¼–è¯‘æ—¶å¸¸é‡é¿å…è¿è¡Œæ—¶è®¡ç®—
3. **ç¼“å­˜ä¼˜åŒ–**: éªŒè¯è§„åˆ™å’Œæ¨¡å¼è¿›è¡Œç¼“å­˜
4. **æ—©æœŸè¿”å›**: å‘ç°é—®é¢˜ç«‹å³è¿”å›ï¼Œé¿å…åç»­éªŒè¯

### æ€§èƒ½ç›‘æ§

é€šè¿‡æ—¥å¿—ç›‘æ§éªŒè¯æ€§èƒ½ï¼š
```java
log.debug("Security validation completed in {}ms for user: {}", duration, userId);
```

## æ‰©å±•æ–¹æ¡ˆ

### 1. æ–°å¢éªŒè¯è§„åˆ™

åœ¨ `SecurityValidationAspect.java` ä¸­æ‰©å±•ï¼š

```java
// æ–°å¢éªŒè¯ç±»å‹
private void validateCustomField(Object value, String fieldName) {
    // è‡ªå®šä¹‰éªŒè¯é€»è¾‘
}

// æ‰©å±•å­—æ®µç±»å‹æ”¯æŒ
private void validateFieldSecurity(Object value, String fieldName, Field field) {
    if (value instanceof CustomType) {
        validateCustomField(value, fieldName);
    }
    // åŸæœ‰é€»è¾‘...
}
```

### 2. æ–°å¢ DTO æ”¯æŒ

åˆ‡é¢è‡ªåŠ¨è¯†åˆ«ä»¥ä¸‹æ¨¡å¼ï¼š
- `*RequestDTO` - è¯·æ±‚æ•°æ®ä¼ è¾“å¯¹è±¡
- `*CreateDTO` - åˆ›å»ºæ“ä½œ DTO
- `*UpdateDTO` - æ›´æ–°æ“ä½œ DTO

è¦æ”¯æŒæ–°æ¨¡å¼ï¼Œä¿®æ”¹ `isRequestDTO()` æ–¹æ³•ï¼š

```java
private boolean isRequestDTO(Object obj) {
    String className = obj.getClass().getSimpleName();
    return className.endsWith("RequestDTO") || 
           className.endsWith("CreateDTO") || 
           className.endsWith("UpdateDTO") ||
           className.endsWith("QueryDTO");  // æ–°å¢æ”¯æŒ
}
```

### 3. ç½‘å…³å±‚è¡¥å……éªŒè¯

å¦‚æœéœ€è¦åœ¨ç½‘å…³å±‚æ·»åŠ è¡¥å……éªŒè¯ï¼š

```java
@Component
public class SecurityGatewayFilter implements GlobalFilter {
    @Override
    public Mono<Void> filter(ServerWebExchange exchange, GatewayFilterChain chain) {
        // åœ¨ç½‘å…³å±‚æ·»åŠ é€šç”¨å®‰å…¨æ£€æŸ¥
        // å¦‚ IP é»‘åå•ã€é¢‘ç‡é™åˆ¶ç­‰
        return chain.filter(exchange);
    }
}
```

### 4. è‡ªå®šä¹‰å®‰å…¨æ³¨è§£

åˆ›å»ºä¸šåŠ¡ç›¸å…³çš„å®‰å…¨éªŒè¯æ³¨è§£ï¼š

```java
@Target({ElementType.TYPE})
@Retention(RetentionPolicy.RUNTIME)
@Constraint(validatedBy = TradingSecurityValidator.class)
public @interface TradingSecurityValidation {
    String message() default "Trading security validation failed";
    Class<?>[] groups() default {};
    Class<? extends Payload>[] payload() default {};
}
```

## ç»´æŠ¤æŒ‡å—

### æ—¥å¸¸ç»´æŠ¤

#### 1. æ—¥å¿—ç›‘æ§
- **DEBUG**: æ­£å¸¸éªŒè¯é€šè¿‡è®°å½•
- **WARN**: å®‰å…¨å¨èƒæ£€æµ‹è®°å½•
- **ERROR**: éªŒè¯è¿‡ç¨‹å¼‚å¸¸è®°å½•

ç›‘æ§é‡ç‚¹ï¼š
```bash
# æŸ¥çœ‹å®‰å…¨å¨èƒæ£€æµ‹
grep "injection attempt detected\|XSS attack attempt detected" application.log

# æŸ¥çœ‹éªŒè¯å¼‚å¸¸
grep "Security validation error" application.log

# ç»Ÿè®¡éªŒè¯é¢‘ç‡
grep "Security validation" application.log | wc -l
```

#### 2. å¨èƒæ¨¡å¼æ›´æ–°
å®šæœŸæ›´æ–°å¨èƒæ£€æµ‹æ¨¡å¼ï¼š

```java
// åœ¨ InputSecurityValidator ä¸­æ›´æ–°
private static final String[] NEW_SQL_KEYWORDS = {
    "EXEC", "DECLARE", "CAST", "CONVERT"  // æ–°å¢æ£€æµ‹æ¨¡å¼
};

private static final String[] NEW_XSS_PATTERNS = {
    "onbeforeunload=", "onpagehide=", "onpageshow="  // æ–°å¢ XSS æ¨¡å¼
};
```

#### 3. æ€§èƒ½è°ƒä¼˜
ç›‘æ§éªŒè¯æ€§èƒ½å½±å“ï¼š

```java
// æ·»åŠ æ€§èƒ½ç›‘æ§
long startTime = System.currentTimeMillis();
validateObjectSecurity(obj);
long endTime = System.currentTimeMillis();
if (endTime - startTime > 5) { // è¶…è¿‡5msè®°å½•
    log.warn("Security validation took {}ms for {}", 
             endTime - startTime, obj.getClass().getSimpleName());
}
```

### å®šæœŸæ£€æŸ¥æ¸…å•

#### æ¯æœˆæ£€æŸ¥
- [ ] æŸ¥çœ‹å®‰å…¨å¨èƒæ£€æµ‹æ—¥å¿—
- [ ] æ›´æ–°å¨èƒç‰¹å¾åº“
- [ ] æ£€æŸ¥éªŒè¯è§„åˆ™è¦†ç›–ç‡
- [ ] è¯„ä¼°æ€§èƒ½å½±å“

#### æ¯å­£åº¦æ£€æŸ¥  
- [ ] å®¡æŸ¥æ–°å¢çš„å®‰å…¨æ¼æ´ç±»å‹
- [ ] æ›´æ–°éªŒè¯é€»è¾‘
- [ ] å‹åŠ›æµ‹è¯•éªŒè¯æ€§èƒ½
- [ ] æ›´æ–°å®‰å…¨æµ‹è¯•ç”¨ä¾‹

#### æ¯å¹´æ£€æŸ¥
- [ ] å…¨é¢å®¡è®¡å®‰å…¨éªŒè¯æ¶æ„
- [ ] è¯„ä¼°æ˜¯å¦éœ€è¦æ¶æ„è°ƒæ•´
- [ ] æ›´æ–°å®‰å…¨éªŒè¯æ–‡æ¡£
- [ ] åŸ¹è®­å¼€å‘å›¢é˜Ÿå®‰å…¨æ„è¯†

### æ•…éšœæ’é™¤

#### å¸¸è§é—®é¢˜

1. **AOP åˆ‡é¢ä¸ç”Ÿæ•ˆ**
   - æ£€æŸ¥ `@EnableAspectJAutoProxy` æ³¨è§£
   - ç¡®è®¤ `ComponentScan` åŒ…å« `commonutils`
   - éªŒè¯ `spring-boot-starter-aop` ä¾èµ–

2. **éªŒè¯è§„åˆ™è¿‡äºä¸¥æ ¼**
   - è°ƒæ•´å¨èƒæ£€æµ‹æ¨¡å¼
   - å¢åŠ ç™½åå•æœºåˆ¶
   - ä¼˜åŒ–å­—æ®µç±»å‹åˆ¤æ–­

3. **æ€§èƒ½å½±å“è¿‡å¤§**
   - å¯ç”¨éªŒè¯ç¼“å­˜
   - å‡å°‘ä¸å¿…è¦çš„å­—æ®µéªŒè¯
   - ä¼˜åŒ–æ­£åˆ™è¡¨è¾¾å¼æ€§èƒ½

4. **è¯¯æŠ¥ç‡è¿‡é«˜**
   - åˆ†æè¯¯æŠ¥æ¨¡å¼
   - è°ƒæ•´æ£€æµ‹é˜ˆå€¼
   - å¢åŠ ä¸Šä¸‹æ–‡åˆ¤æ–­

### å‡çº§æŒ‡å—

å½“éœ€è¦å‡çº§å®‰å…¨éªŒè¯åŠŸèƒ½æ—¶ï¼š

1. **å‡†å¤‡é˜¶æ®µ**
   - å¤‡ä»½å½“å‰é…ç½®
   - å‡†å¤‡å›æ»šæ–¹æ¡ˆ
   - é€šçŸ¥ç›¸å…³å›¢é˜Ÿ

2. **æµ‹è¯•é˜¶æ®µ**
   - åœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯
   - è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
   - æ€§èƒ½å›å½’æµ‹è¯•

3. **éƒ¨ç½²é˜¶æ®µ**
   - ç°åº¦å‘å¸ƒç­–ç•¥
   - ç›‘æ§å…³é”®æŒ‡æ ‡
   - åŠæ—¶å“åº”é—®é¢˜

4. **éªŒè¯é˜¶æ®µ**
   - è¿è¡Œå®‰å…¨æµ‹è¯•
   - æ£€æŸ¥æ—¥å¿—è®°å½•
   - ç¡®è®¤åŠŸèƒ½æ­£å¸¸

## æ€»ç»“

æœ¬ AOP å®‰å…¨éªŒè¯æ¶æ„é€šè¿‡åŒå±‚é˜²æŠ¤æœºåˆ¶ï¼Œä¸ºäºŒå…ƒæœŸæƒäº¤æ˜“å¹³å°æä¾›äº†å…¨é¢çš„å®‰å…¨ä¿æŠ¤ã€‚é€šè¿‡è‡ªåŠ¨åŒ–çš„å®‰å…¨éªŒè¯ï¼Œç¡®ä¿äº†ç³»ç»Ÿçš„å®‰å…¨æ€§å’Œå¯ç»´æŠ¤æ€§ï¼ŒåŒæ—¶ä¿æŒäº†è‰¯å¥½çš„æ€§èƒ½è¡¨ç°ã€‚

### æ ¸å¿ƒä»·å€¼

- **è‡ªåŠ¨åŒ–å®‰å…¨**: æ— éœ€æ‰‹åŠ¨æ·»åŠ éªŒè¯ï¼Œæ‰€æœ‰æ¥å£è‡ªåŠ¨å—ä¿æŠ¤
- **çºµæ·±é˜²å¾¡**: AOP + Bean Validation åŒå±‚éªŒè¯æœºåˆ¶
- **ç±»å‹å®‰å…¨**: åŸºäºå¼ºç±»å‹ç³»ç»Ÿï¼ŒéªŒè¯æ›´ç²¾ç¡®
- **å¯æ‰©å±•æ€§**: æ”¯æŒä¸šåŠ¡ç›¸å…³çš„å¤æ‚éªŒè¯è§„åˆ™
- **é«˜æ€§èƒ½**: æœ€å°åŒ–æ€§èƒ½å½±å“ï¼Œæ”¯æŒé«˜å¹¶å‘åœºæ™¯

### æœ€ä½³å®è·µ

1. **å®šæœŸæ›´æ–°å¨èƒåº“**: ä¿æŒå®‰å…¨æ£€æµ‹çš„æ—¶æ•ˆæ€§
2. **ç›‘æ§éªŒè¯æ—¥å¿—**: åŠæ—¶å‘ç°å’Œå“åº”å®‰å…¨å¨èƒ
3. **æ€§èƒ½æŒç»­ä¼˜åŒ–**: ç¡®ä¿å®‰å…¨éªŒè¯ä¸å½±å“ç³»ç»Ÿæ€§èƒ½
4. **æµ‹è¯•è¦†ç›–å®Œæ•´**: å®šæœŸè¿è¡Œå®‰å…¨æµ‹è¯•ç¡®ä¿åŠŸèƒ½æ­£å¸¸
5. **æ–‡æ¡£åŠæ—¶æ›´æ–°**: ä¿æŒæ–‡æ¡£ä¸å®ç°çš„åŒæ­¥

é€šè¿‡è¿™å¥—å®‰å…¨éªŒè¯æ¶æ„ï¼Œå¹³å°èƒ½å¤Ÿæœ‰æ•ˆé˜²å¾¡å¸¸è§çš„ Web å®‰å…¨å¨èƒï¼Œä¸ºç”¨æˆ·äº¤æ˜“æä¾›å®‰å…¨å¯é çš„ç¯å¢ƒã€‚