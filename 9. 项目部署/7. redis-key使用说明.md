# Redis Key 使用说明

## 概述

本文档面向运维团队，提供Binary Option平台使用的Redis key的完整说明，包括key的命名规范、分类、用途以及运维监控建议。

## 配置文件位置

Redis key的定义和管理集中在以下配置文件：

```
option-common-utils/src/main/java/com/binaryoption/commonutils/constants/CacheConstants.java
```

该文件是系统中所有Redis key的唯一配置源，确保了key的统一管理和维护。

## 命名规范

### 基本格式

系统使用两种key命名格式：

1. **OAuth token（全局标准）**：`OAuth:AccessToken:{token}`
2. **业务key**：`BO:{Module}:{Business}:{identifier}`

### 命名约定

- **前缀**：`BO`（Binary Option缩写）或 `OAuth`（OAuth认证）
- **分隔符**：冒号（`:`）
- **命名风格**：CamelCase（驼峰命名）
- **模块标识**：如Market、Order、User、Auth、Btse等

## Redis Key 分类

### 1. OAuth认证相关

| Key模式 | 用途 | 示例 | TTL |
|---------|------|------|-----|
| `OAuth:AccessToken:{token}` | OAuth访问令牌存储 | `OAuth:AccessToken:abc123def456` | 根据token过期时间 |

**运维说明**：
- 这是OAuth认证的核心key，不可修改格式
- 存储用户认证信息的JSON数据
- 自动过期清理，无需手动维护

### 2. 用户相关缓存

| Key模式 | 用途 | 示例 | TTL |
|---------|------|------|-----|
| `BO:User:Mapping:{username}` | OAuth用户名到ID映射 | `BO:User:Mapping:testuser01` | 24小时 |

**运维说明**：
- 用户映射关系用于OAuth认证加速，有24小时TTL
- Gateway和User服务都会使用此缓存

### 3. 市场数据缓存

| Key模式 | 用途 | 示例 | TTL | 说明 |
|---------|------|------|-----|------|
| `BO:Market:Symbols::Active` | 活跃交易对列表 | `BO:Market:Symbols::Active` | 10分钟 | Spring Cache自动管理 |
| `BO:Market:Symbol::{symbol}` | 根据符号缓存交易对 | `BO:Market:Symbol::BTC-USDT` | 10分钟 | getSymbolConfig方法缓存 |
| `BO:Market:Symbol::{id}` | 根据ID缓存交易对 | `BO:Market:Symbol::1` | 10分钟 | getSymbolById方法缓存 |

**运维说明**：
- 使用Spring Cache注解管理（@Cacheable），自动过期
- TTL在CacheConfig.java中配置为10分钟
- 支持通过refreshSymbolCache方法手动清除所有缓存

### 4. 分布式锁

| Key模式 | 用途 | 示例 | TTL |
|---------|------|------|-----|
| `BO:Order:Settlement:Lock` | 订单结算锁 | `BO:Order:Settlement:Lock` | 60秒 |
| `BO:Order:Hedge:Compensation:Lock` | 订单对冲补偿锁 | `BO:Order:Hedge:Compensation:Lock` | 30秒 |
| `BO:Order:Round:Maintenance:Lock` | 交易轮次维护锁 | `BO:Order:Round:Maintenance:Lock` | 300秒 |
| `BO:User:Stats:Reset:Lock` | 用户统计重置锁 | `BO:User:Stats:Reset:Lock` | 60秒 |
| `BO:Btse:TransferIn:Compensation:Lock` | BTSE转入补偿锁 | `BO:Btse:TransferIn:Compensation:Lock` | 30秒 |
| `BO:Btse:TransferOut:Compensation:Lock` | BTSE转出补偿锁 | `BO:Btse:TransferOut:Compensation:Lock` | 30秒 |

**运维说明**：
- 分布式锁用于防止定时任务重复执行
- 自动过期释放，防止死锁
- 如需手动释放锁，可直接删除对应key
