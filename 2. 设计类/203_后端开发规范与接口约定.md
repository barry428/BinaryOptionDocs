# 后端开发规范与接口约定

> 本文档结合二元期权平台产品需求，梳理后端开发的通用规范、接口约定及团队协作建议，适用于所有微服务及后续扩展。

---

## 1. 领域模型与DTO定义规范
- 领域模型（domain/entity）应准确表达业务核心对象及其行为，属性命名与业务语义一致。
- DTO（数据传输对象）用于接口入参/出参，字段命名与前端/调用方保持一致，避免直接暴露实体类。
- DTO与实体类分离，便于接口演进和安全控制。
- 建议所有DTO、VO统一放在`dto/`目录，领域模型放在`domain/`目录。

## 2. 接口协议与文档约定
- 采用RESTful风格，资源路径、HTTP动词语义清晰。
- 状态码：200（成功），4xx（客户端错误），5xx（服务端错误），业务错误用自定义code区分。
- 错误码与错误信息统一管理，便于前后端联调和排查。
- 所有接口应有Swagger/OpenAPI注解，自动生成接口文档，便于前后端、服务间对接。
- 建议接口响应结构：
  ```json
  {
    "code": 0,
    "msg": "success",
    "data": { ... }
  }
  ```

## 3. 服务间调用约定
- 推荐使用FeignClient进行服务间HTTP调用，接口与DTO与被调用服务保持同步。
- FeignClient接口统一放在`client/`目录，命名如`UserServiceClient`。
- 服务注册与发现用Nacos/Eureka，服务名规范统一。
- 服务间调用需设置超时、重试、降级等容错策略。
- 服务间异常建议用自定义异常类，避免直接抛出原始异常。

## 4. 通用中间件与基础设施配置
- 数据库、Redis、消息队列等基础设施配置集中管理，支持多环境切换（dev/test/prod）。
- 日志采用logback，日志格式统一，支持链路追踪（如Sleuth、SkyWalking）。
- 监控、告警、链路追踪等建议接入Prometheus、ELK、SkyWalking等平台。
- 配置中心建议用Nacos/Spring Cloud Config，敏感信息加密。

## 5. 统一异常与返回值规范
- 全局异常处理采用@ControllerAdvice，统一返回格式。
- 业务异常用自定义异常类（如ServiceException），包含错误码和错误信息。
- 所有接口返回结构统一，便于前后端、服务间处理。

## 6. 权限与安全策略
- 对外接口（controller）必须严格鉴权（如JWT、OAuth2），防止未授权访问。
- 对内接口（rpc/internal）可用服务间token、IP白名单、网关认证等方式简化鉴权，但仍需基本安全措施。
- 敏感操作建议加操作日志、审计追踪。

## 7. 开发规范与代码模板
- 包命名、类命名、方法命名遵循统一规范，见`src/main/java/com/example/orderservice/`目录结构。
- 注释规范，关键业务逻辑、接口、DTO需有注释说明。
- 强制单元测试，service/dao层需覆盖核心逻辑。
- 代码风格建议采用阿里Java开发手册或团队约定。

## 8. CI/CD与环境准备
- 建议采用Jenkins/GitLab CI等自动化构建、测试、部署。
- 支持多环境配置（dev/test/stage/prod），配置文件分环境管理。
- Dockerfile、Helm Chart等容器化、K8s部署脚本需随代码维护。

## 9. 业务流程与用例梳理
- 复杂业务建议画流程图、时序图、用例图，便于开发、测试、评审。
- 关键用例需有详细说明，接口参数、状态流转、异常场景等需明确。

## 10. 测试用例与Mock数据
- 所有核心接口、关键业务流程需有单元测试、集成测试用例。
- 提供Mock数据和接口，便于前后端、服务间联调。
- 测试用例需覆盖正常、异常、边界场景。

---

> 本规范为团队协作和高质量交付的基础，建议所有成员遵循。如有特殊需求可在此基础上补充细化。 