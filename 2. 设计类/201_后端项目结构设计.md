# BinaryOption 后端项目结构设计（微服务多模块版）

> 本文档基于最新微服务架构方案，说明 BinaryOption 后端采用 Spring Cloud 多模块多服务、统一依赖管理、工具类复用、独立部署的最佳实践结构，适用于企业级扩展和团队协作。

## 一、总体结构

采用 Spring Cloud 微服务架构，每个业务领域独立服务，统一父模块（option-parent）管理依赖，通用工具/DTO 独立抽取（option-common-utils），各服务独立部署、独立配置，支持后续弹性扩展。

### 目录结构示意
```
BinaryOption/
├── option-parent/                # 父模块，统一依赖和版本管理
├── option-common-utils/          # 通用工具类、DTO、安全等复用代码
├── option-common-service/        # 通用基础服务（如用户、账户等）
├── option-order-service/         # 订单与风控服务
├── option-market-service/        # 行情服务
├── option-xxl-job/               # 分布式任务调度（如 XXL-JOB）
├── docs/                         # 项目文档
└── ...

# 以 option-order-service 为例
option-order-service/
├── pom.xml
├── src/
│   ├── main/
│   │   ├── java/com/binaryoption/orderservice/
│   │   │   ├── Application.java         # 启动类
│   │   │   ├── config/                  # 配置类
│   │   │   ├── controller/              # REST 接口
│   │   │   ├── client/                  # 外部服务调用
│   │   │   ├── service/                 # 业务逻辑
│   │   │   ├── repository/              # DAO/持久层
│   │   │   ├── domain/                  # 实体/领域模型
│   │   │   ├── dto/                     # 业务DTO
│   │   │   └── util/                    # 服务内工具类
│   │   └── resources/
│   │       ├── application.yml          # 独立配置
│   │       └── ...
│   └── test/
│       └── ...
└── ...

option-common-utils/
├── pom.xml
├── src/main/java/com/binaryoption/commonutils/
│   ├── redis/RedisUtil.java
│   ├── mq/RocketMQUtil.java
│   ├── security/CustomUserDetails.java
│   ├── dto/UserDTO.java
│   └── ...
└── ...
```

## 二、各模块说明

- **option-parent**：父 pom，统一管理所有三方依赖版本，所有子模块 parent 指向此模块。
- **option-common-utils**：通用工具类、DTO、安全相关代码，所有服务只依赖 utils，不直接依赖其他服务。
- **option-common-service**：通用基础服务（如用户、账户、通知等），仅暴露 API，不含可复用工具类。
- **option-order-service**：订单与风控服务，独立部署，依赖 utils。
- **option-market-service**：行情服务，独立部署，依赖 utils。
- **option-xxl-job**：分布式任务调度服务。
- **docs/**：项目设计、接口、运维等文档。

## 三、依赖与配置管理

- **依赖管理**：所有三方依赖（Spring Boot、Lombok、MySQL、JWT、OpenAPI、Spring Cloud 等）统一在 option-parent 的 `<dependencyManagement>`，子模块依赖无需写 version。
- **自有模块依赖**（如 option-common-utils）：子模块依赖时需写 `<version>0.0.1-SNAPSHOT</version>`。
- **配置管理**：每个服务有独立 application.yml，敏感信息建议用环境变量或配置中心（如 Nacos、Apollo）。
- **插件管理**：如 spring-boot-maven-plugin 只在可执行服务模块配置。

## 四、开发与部署流程

1. **开发调试**：
   - 推荐在 IDE 直接运行各服务的 Application.java，支持断点、热部署、日志直观。
   - 多服务可并行启动，便于联调。
2. **本地构建**：
   - 多模块项目推荐 `mvn clean install`，保证依赖模块先编译、安装到本地仓库。
   - 只需打包产物时可用 `mvn clean package`。
3. **生产部署**：
   - 只需将各服务的 jar 包上传到生产服务器，直接用 `java -jar` 启动。
   - 推荐用 CI/CD 工具（如 Jenkins、GitLab CI）自动化打包、上传、部署。
   - 生产环境无需 Maven、源码，仅需 jar 包和配置文件。
4. **配置中心/注册中心**（可选）：
   - 推荐后续集成 Nacos、Apollo 等配置中心，支持多环境、动态配置。
   - 微服务注册与发现可用 Nacos、Eureka、Consul 等。

## 五、后续可扩展性

- 支持服务横向扩展、弹性伸缩、独立部署与升级。
- 支持配置中心、注册中心、链路追踪、健康检查等企业级能力。
- 通用工具类、DTO、认证等全部标准化、模块化，便于维护和复用。
- 结构天然支持多团队并行开发、后续业务快速扩展。

## 六、新项目对接原有团队/系统的关键问题清单

### 1. 环境与部署
- 需要哪些环境？（开发、测试、预发、生产）
- 各环境的网络、域名、端口、访问控制策略？
- 是否有统一的 CI/CD 流程？如何对接？
- 日志采集、监控、告警如何接入原有体系？
- 生产环境的变更、回滚、应急流程？

### 2. 测试与数据隔离
- 测试环境是否和生产环境数据隔离？如何保证？
- 测试数据如何生成、清理？是否有专用测试账号？
- 联调环境如何搭建？是否有专用的联调白名单？

### 3. 系统打通与接口联调
- 账号体系如何对接？是否需要单点登录（SSO）？
- 权限体系如何对接？是否有统一的用户、角色、权限管理？
- 网关、API管理、接口文档如何同步？
- 接口联调流程、异常处理、同步机制如何约定？
- 是否有接口变更通知机制？

### 4. 风控与合规
- 是否有统一的风控规则、黑名单、合规要求？
- 风控数据如何同步？合规审计如何对接？
- 敏感操作、数据访问的审计要求？

### 5. 数据库与性能
- 数据库是否需要分表、归档？主从、读写分离如何实现？
- 数据同步、数据一致性如何保证？
- 性能瓶颈、容量规划、扩容策略？

### 6. 架构与技术选型
- 是否需要与原有系统保持技术栈一致？（如 Spring Cloud、Nacos、RocketMQ 等）
- 微服务注册、配置、服务发现如何对接？
- 是否有后续 K8s、服务网格等演进计划？

### 7. 运维与安全
- 日志、监控、告警如何对接原有平台？
- 安全策略、访问控制、API 鉴权如何统一？
- 灰度发布、流量切换、应急预案？

### 8. 团队协作与流程
- 需求、开发、测试、上线的协作流程？
- 代码管理、分支策略、代码评审机制？
- 文档、接口、变更、问题跟踪如何同步？ 

### 8. 功能补充
- 支持多种资产交易，支持多种时间段选择
- 后台管理功能
