# æå–å…±äº«æ¨¡å—æ–¹æ¡ˆ

> ç‰ˆæœ¬: v1.2
> åˆ›å»ºæ—¥æœŸ: 2025-12-30
> æ›´æ–°æ—¥æœŸ: 2025-12-30
> çŠ¶æ€: æ¸…ç†ä»»åŠ¡å·²æ‰§è¡Œå®Œæˆ

---

## 1. èƒŒæ™¯ä¸ç›®æ ‡

### 1.1 å½“å‰çŠ¶å†µ

æœåŠ¡åˆå¹¶åï¼Œ`binary-option-app` åŒ…å«ä»¥ä¸‹æ¨¡å—ï¼š

```
com.binaryoption/
â”œâ”€â”€ common/      # ç”¨æˆ·è´¦æˆ·æ¨¡å—
â”œâ”€â”€ order/       # è®¢å•äº¤æ˜“æ¨¡å—
â”œâ”€â”€ market/      # è¡Œæƒ…æ•°æ®æ¨¡å—
â””â”€â”€ gateway/     # ç½‘å…³æ¨¡å—
```

å„æ¨¡å—é—´å­˜åœ¨ä¸€äº›é‡å¤çš„æ¨¡å¼å’Œå¯å¤ç”¨çš„ç»„ä»¶ï¼Œä½†ç›®å‰åˆ†æ•£åœ¨å„è‡ªçš„åŒ…ä¸­ã€‚

### 1.2 ç›®æ ‡

æå–çœŸæ­£é€šç”¨çš„ç»„ä»¶åˆ° `shared/` æ¨¡å—ï¼Œå®ç°ï¼š
- **ä»£ç å¤ç”¨**: å‡å°‘é‡å¤ä»£ç 
- **ç»Ÿä¸€æ ‡å‡†**: ç»Ÿä¸€é…ç½®ã€ç¼“å­˜ã€å·¥å…·ç±»çš„å®ç°æ–¹å¼
- **æ˜“äºç»´æŠ¤**: é€šç”¨ç»„ä»¶é›†ä¸­ç®¡ç†

### 1.3 åŸåˆ™

- **å¿…è¦æ€§åŸåˆ™**: åªæå–ç¡®å®è¢«å¤šä¸ªæ¨¡å—ä½¿ç”¨çš„ç»„ä»¶
- **ç¨³å®šæ€§åŸåˆ™**: æå–çš„ç»„ä»¶åº”è¯¥æ˜¯ç¨³å®šçš„ï¼Œä¸é¢‘ç¹å˜åŒ–çš„
- **æœ€å°ä¾èµ–åŸåˆ™**: shared æ¨¡å—ä¸åº”ä¾èµ–ä¸šåŠ¡æ¨¡å—

---

## 2. ç°çŠ¶åˆ†æ

### 2.1 å„æ¨¡å—é…ç½®ç±»

| æ¨¡å— | é…ç½®ç±» | åŠŸèƒ½ | æ˜¯å¦å¯å…±äº« |
|------|--------|------|-----------|
| common | `BtseIntegrationConfig` | BTSE API é…ç½® | âŒ ä¸šåŠ¡ä¸“ç”¨ |
| common | `CommonServiceMyBatisConfig` | MyBatis é…ç½® | âš ï¸ å¯æå–åŸºç±» |
| common | `CommonServiceSecurityConfig` | å®‰å…¨é…ç½® | âŒ ä¸šåŠ¡ä¸“ç”¨ |
| common | `CommonServiceSwaggerConfig` | Swagger é…ç½® | âœ… å¯é€šç”¨åŒ– |
| order | `CacheConfig` | Redis ç¼“å­˜é…ç½® | âœ… å¯é€šç”¨åŒ– |
| order | `OrderConfig` | è®¢å•ä¸šåŠ¡é…ç½® | âŒ ä¸šåŠ¡ä¸“ç”¨ |
| order | `SettlementExecutorConfig` | çº¿ç¨‹æ± é…ç½® | âš ï¸ å¯æå–åŸºç±» |
| gateway | è¿‡æ»¤å™¨é…ç½® | ç½‘å…³è¿‡æ»¤å™¨ | âŒ ç½‘å…³ä¸“ç”¨ |
| market | WebSocket é…ç½® | WS é…ç½® | âŒ å¸‚åœºä¸“ç”¨ |

### 2.2 å„æ¨¡å—è½¬æ¢å™¨

| æ¨¡å— | è½¬æ¢å™¨ | åŠŸèƒ½ | æ˜¯å¦å¯å…±äº« |
|------|--------|------|-----------|
| common | `UserConverter` | User å®ä½“è½¬ DTO | âŒ ä¸šåŠ¡ä¸“ç”¨ |
| common | `AccountConverter` | Account å®ä½“è½¬ DTO | âŒ ä¸šåŠ¡ä¸“ç”¨ |
| order | `OrderConverter` | Order å®ä½“è½¬ DTO | âŒ ä¸šåŠ¡ä¸“ç”¨ |
| order | `SymbolConverter` | Symbol å®ä½“è½¬ DTO | âŒ ä¸šåŠ¡ä¸“ç”¨ |

### 2.3 ç¼“å­˜æœåŠ¡

| æœåŠ¡ | ä½ç½® | åŠŸèƒ½ | æ˜¯å¦å¯å…±äº« |
|------|------|------|-----------|
| `MarketCacheService` | market/cache | å¸‚åœºæ•°æ®ç¼“å­˜ | âŒ å·²ç»Ÿä¸€ |
| `HistoryPriceQueryService` | order/cache | å†å²ä»·æ ¼æŸ¥è¯¢ | âŒ ä¸šåŠ¡ä¸“ç”¨ |

### 2.4 ç°æœ‰å…±äº«æ¨¡å— (option-common-utils)

å·²å­˜åœ¨çš„å…±äº«æ¨¡å—æä¾›ï¼š
- `GlobalExceptionHandler` - å…¨å±€å¼‚å¸¸å¤„ç†
- `BusinessException` - ä¸šåŠ¡å¼‚å¸¸
- `MessageUtils` - i18n æ¶ˆæ¯å·¥å…·
- `CacheConstants` - ç¼“å­˜å¸¸é‡
- `BusinessConstants` - ä¸šåŠ¡å¸¸é‡
- `DistributedLock` - åˆ†å¸ƒå¼é”
- `ErrorCode` - é”™è¯¯ç 

### 2.5 æ·±åº¦åˆ†æå‘ç°çš„é—®é¢˜ (v1.1 æ–°å¢)

#### 2.5.1 åŒ…åä¸ä¸€è‡´é—®é¢˜ âš ï¸

**ä½ç½®**: `common/controller/` ç›®å½•

| æ–‡ä»¶ | å®é™…åŒ…å | æœŸæœ›åŒ…å |
|------|---------|---------|
| `AccountRpcController.java` | `com.binaryoption.common.rpc` | `com.binaryoption.common.controller` |
| `UserRpcController.java` | `com.binaryoption.common.rpc` | `com.binaryoption.common.controller` |
| `BtseTransferRpcController.java` | `com.binaryoption.common.rpc` | `com.binaryoption.common.controller` |
| `ReconciliationRpcController.java` | `com.binaryoption.common.rpc` | `com.binaryoption.common.controller` |

**é—®é¢˜**: æ–‡ä»¶ç‰©ç†ä½ç½®åœ¨ `controller/` ä½†åŒ…å£°æ˜ä¸º `rpc`ï¼Œè¿å Java åŒ…è§„èŒƒ

**å»ºè®®**:
- æ–¹æ¡ˆ A: ä¿®æ­£åŒ…åä¸º `com.binaryoption.common.controller`
- æ–¹æ¡ˆ B: åˆ›å»º `common/rpc/` ç›®å½•ï¼Œç§»åŠ¨è¿™äº›æ–‡ä»¶

#### 2.5.2 æµ‹è¯•æ§åˆ¶å™¨æ®‹ç•™ ğŸ—‘ï¸

| æ–‡ä»¶ | ä½ç½® | ç”¨é€” | å»ºè®® |
|------|------|------|------|
| `SecurityTestController.java` | `order/controller/` | å®‰å…¨éªŒè¯æµ‹è¯• | åˆ é™¤ |
| `TestI18nController.java` | `order/controller/` | i18n è°ƒè¯• | åˆ é™¤ |

**åŸå› **: ä»…ç”¨äºå¼€å‘è°ƒè¯•ï¼Œç”Ÿäº§ç¯å¢ƒä¸éœ€è¦

#### 2.5.3 ç©ºç›®å½•æ®‹ç•™ ğŸ—‘ï¸

| ç›®å½• | çŠ¶æ€ |
|------|------|
| `common/exception/` | ç©ºç›®å½•ï¼Œéœ€åˆ é™¤ |
| `order/exception/` | ç©ºç›®å½•ï¼Œéœ€åˆ é™¤ |

#### 2.5.4 æœ¬åœ° DTO åˆ†æ

`order/dto/` åŒ…å«ä»¥ä¸‹å†…éƒ¨ DTOï¼š

| DTO | ç”¨é€” | æ˜¯å¦ç§»åˆ° common-dto |
|-----|------|-------------------|
| `CompensationResult.java` | è¡¥å¿ä»»åŠ¡ç»“æœ | âŒ å†…éƒ¨ä½¿ç”¨ |
| `RiskCheckResult.java` | é£æ§æ£€æŸ¥ç»“æœ | âŒ å†…éƒ¨ä½¿ç”¨ |
| `Stats24hDTO.java` | 24h ç»Ÿè®¡æ•°æ® | âŒ å†…éƒ¨ä½¿ç”¨ |
| `Stats24hResult.java` | 24h ç»Ÿè®¡ç»“æœ | âŒ å†…éƒ¨ä½¿ç”¨ |

**ç»“è®º**: è¿™äº› DTO ä»…åœ¨ order æ¨¡å—å†…éƒ¨ä½¿ç”¨ï¼Œä¸éœ€è¦ç§»åˆ°å…±äº«æ¨¡å—

---

## 3. æå–å»ºè®®

### 3.1 å»ºè®®æå–åˆ° shared æ¨¡å—çš„ç»„ä»¶

#### 3.1.1 Redis ç¼“å­˜é…ç½® (é«˜ä¼˜å…ˆçº§)

**å½“å‰ä½ç½®**: `order/config/CacheConfig.java`

**é—®é¢˜**: Redis é…ç½®ï¼ˆCacheManagerã€RedisTemplateï¼‰æ˜¯é€šç”¨çš„ï¼Œä½†ç›®å‰æ”¾åœ¨ order æ¨¡å—

**å»ºè®®**:
```
shared/config/
â””â”€â”€ RedisCacheConfig.java    # é€šç”¨ Redis é…ç½®
```

**å†…å®¹**:
- `CacheManager` Bean (ç”¨äº @Cacheable)
- `RedisTemplate<String, Object>` Bean
- ç»Ÿä¸€çš„ `ObjectMapper` é…ç½®

#### 3.1.2 çº¿ç¨‹æ± é…ç½®æ¨¡æ¿ (ä¸­ä¼˜å…ˆçº§)

**å½“å‰ä½ç½®**: `order/config/SettlementExecutorConfig.java`

**å»ºè®®**: æå–é€šç”¨çš„çº¿ç¨‹æ± é…ç½®åŸºç±»

```
shared/config/
â””â”€â”€ ThreadPoolConfig.java    # é€šç”¨çº¿ç¨‹æ± é…ç½®åŸºç±»
```

**å†…å®¹**:
```java
@Configuration
public class ThreadPoolConfig {

    protected ThreadPoolTaskExecutor createExecutor(
            String namePrefix,
            int coreSize,
            int maxSize,
            int queueCapacity) {
        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();
        executor.setCorePoolSize(coreSize);
        executor.setMaxPoolSize(maxSize);
        executor.setQueueCapacity(queueCapacity);
        executor.setThreadNamePrefix(namePrefix);
        executor.setRejectedExecutionHandler(new ThreadPoolExecutor.CallerRunsPolicy());
        executor.initialize();
        return executor;
    }
}
```

#### 3.1.3 Swagger é…ç½® (ä½ä¼˜å…ˆçº§)

**å½“å‰ä½ç½®**: `common/config/CommonServiceSwaggerConfig.java`

**å»ºè®®**: å¦‚æœæœªæ¥æœ‰å¤šä¸ª Swagger åˆ†ç»„éœ€æ±‚ï¼Œå¯æå–

```
shared/config/
â””â”€â”€ SwaggerConfig.java       # é€šç”¨ Swagger é…ç½®
```

### 3.2 å»ºè®®ä¿ç•™åœ¨å„æ¨¡å—çš„ç»„ä»¶

| ç»„ä»¶ | åŸå›  |
|------|------|
| `BtseIntegrationConfig` | BTSE é›†æˆä¸“ç”¨ï¼Œä¸ä¼šè¢«å…¶ä»–æ¨¡å—ä½¿ç”¨ |
| `OrderConfig` | è®¢å•ä¸šåŠ¡ä¸“ç”¨é…ç½® |
| æ‰€æœ‰ Converter | å„ä¸šåŠ¡å®ä½“è½¬æ¢é€»è¾‘ä¸åŒ |
| `MarketCacheService` | å¸‚åœºæ•°æ®ä¸“ç”¨ï¼Œå·²ç»Ÿä¸€ |
| Gateway Filters | ç½‘å…³ä¸“ç”¨è¿‡æ»¤å™¨ |

### 3.3 ä¸å»ºè®®æå–çš„åŸå› 

ä»¥ä¸‹ç»„ä»¶**ä¸å»ºè®®**æå–åˆ° sharedï¼š

1. **ä¸šåŠ¡ Converter**: æ¯ä¸ªå®ä½“çš„è½¬æ¢é€»è¾‘ä¸åŒï¼Œå¼ºè¡Œç»Ÿä¸€ä¼šå¢åŠ å¤æ‚åº¦
2. **ä¸šåŠ¡ Config**: å„æ¨¡å—é…ç½®å‚æ•°ä¸åŒï¼Œæ²¡æœ‰å¤ç”¨ä»·å€¼
3. **Domain/DTO**: å·²æœ‰ `option-common-dto` æ¨¡å—
4. **Exception**: å·²æœ‰ `option-common-utils` ä¸­çš„ `GlobalExceptionHandler`

---

## 4. ç›®æ ‡ç»“æ„

### 4.1 æå–åçš„ç»“æ„

```
binary-option-app/src/main/java/com/binaryoption/
â”œâ”€â”€ BinaryOptionApplication.java
â”‚
â”œâ”€â”€ shared/                          # æ–°å¢ï¼šå…±äº«æ¨¡å—
â”‚   â””â”€â”€ config/
â”‚       â”œâ”€â”€ RedisCacheConfig.java    # ç»Ÿä¸€ Redis é…ç½®
â”‚       â””â”€â”€ ThreadPoolConfig.java    # çº¿ç¨‹æ± é…ç½®åŸºç±»
â”‚
â”œâ”€â”€ common/                          # ç”¨æˆ·è´¦æˆ·æ¨¡å—
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”œâ”€â”€ BtseIntegrationConfig.java
â”‚   â”‚   â”œâ”€â”€ CommonServiceMyBatisConfig.java
â”‚   â”‚   â”œâ”€â”€ CommonServiceSecurityConfig.java
â”‚   â”‚   â””â”€â”€ CommonServiceSwaggerConfig.java
â”‚   â”œâ”€â”€ controller/
â”‚   â”œâ”€â”€ converter/
â”‚   â”œâ”€â”€ domain/
â”‚   â”œâ”€â”€ integration/
â”‚   â”œâ”€â”€ mapper/
â”‚   â””â”€â”€ service/
â”‚
â”œâ”€â”€ order/                           # è®¢å•äº¤æ˜“æ¨¡å—
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”œâ”€â”€ OrderConfig.java
â”‚   â”‚   â””â”€â”€ SettlementExecutorConfig.java  # ç»§æ‰¿ ThreadPoolConfig
â”‚   â”œâ”€â”€ cache/
â”‚   â”œâ”€â”€ controller/
â”‚   â”œâ”€â”€ converter/
â”‚   â”œâ”€â”€ domain/
â”‚   â”œâ”€â”€ dto/
â”‚   â”œâ”€â”€ mapper/
â”‚   â”œâ”€â”€ pricing/
â”‚   â”œâ”€â”€ service/
â”‚   â””â”€â”€ task/
â”‚
â”œâ”€â”€ market/                          # è¡Œæƒ…æ•°æ®æ¨¡å—
â”‚   â”œâ”€â”€ cache/
â”‚   â”‚   â””â”€â”€ MarketCacheService.java
â”‚   â”œâ”€â”€ config/
â”‚   â””â”€â”€ ws/
â”‚
â””â”€â”€ gateway/                         # ç½‘å…³æ¨¡å—
    â”œâ”€â”€ config/
    â”œâ”€â”€ filter/
    â””â”€â”€ service/
```

### 4.2 ä¸ç°æœ‰å…±äº«æ¨¡å—çš„å…³ç³»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    binary-option-app                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ common  â”‚  â”‚  order  â”‚  â”‚ market  â”‚  â”‚ gateway â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â”‚
â”‚       â”‚            â”‚            â”‚            â”‚          â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                         â”‚                               â”‚
â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚                  â”‚   shared    â”‚  â† æœ¬æ–¹æ¡ˆæ–°å¢          â”‚
â”‚                  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                         â†“                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              option-common-utils                 â”‚   â”‚
â”‚  â”‚  (GlobalExceptionHandler, BusinessException,    â”‚   â”‚
â”‚  â”‚   MessageUtils, DistributedLock, Constants)     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                         â†“                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              option-common-dto                   â”‚   â”‚
â”‚  â”‚  (AccountDTO, OrderDTO, UserDTO, MarketTickDTO) â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. å®æ–½æ­¥éª¤

### 5.1 Phase 1: æå– Redis é…ç½® (å»ºè®®æ‰§è¡Œ)

**æ­¥éª¤**:
1. åˆ›å»º `shared/config/RedisCacheConfig.java`
2. ä» `order/config/CacheConfig.java` ç§»åŠ¨é€šç”¨é…ç½®
3. åˆ é™¤ `order/config/CacheConfig.java`
4. éªŒè¯ç¼–è¯‘å’Œæµ‹è¯•

**é¢„è®¡å½±å“**: ä½é£é™©ï¼Œåªæ˜¯æ–‡ä»¶ä½ç½®å˜åŒ–

### 5.2 Phase 2: æå–çº¿ç¨‹æ± åŸºç±» (å¯é€‰)

**æ­¥éª¤**:
1. åˆ›å»º `shared/config/ThreadPoolConfig.java`
2. `SettlementExecutorConfig` ç»§æ‰¿åŸºç±»
3. éªŒè¯ç¼–è¯‘å’Œæµ‹è¯•

**é¢„è®¡å½±å“**: ä½é£é™©ï¼Œå¢åŠ ä»£ç å¤ç”¨

### 5.3 Phase 3: æ¸…ç†ç©ºç›®å½• (å»ºè®®æ‰§è¡Œ)

**æ­¥éª¤**:
1. åˆ é™¤ç©ºçš„ `common/exception/` ç›®å½•
2. åˆ é™¤ç©ºçš„ `order/exception/` ç›®å½•

### 5.4 Phase 4: åˆ é™¤æµ‹è¯•æ§åˆ¶å™¨ (å»ºè®®æ‰§è¡Œ) - v1.1 æ–°å¢

**æ­¥éª¤**:
1. åˆ é™¤ `order/controller/SecurityTestController.java`
2. åˆ é™¤ `order/controller/TestI18nController.java`
3. éªŒè¯ç¼–è¯‘

**é¢„è®¡å½±å“**: æ— é£é™©ï¼Œä»…ç§»é™¤è°ƒè¯•ä»£ç 

### 5.5 Phase 5: ä¿®æ­£åŒ…åä¸ä¸€è‡´ (å»ºè®®æ‰§è¡Œ) - v1.1 æ–°å¢

**æ–¹æ¡ˆ A (æ¨è): ä¿®æ­£åŒ…å**

```bash
# éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶
common/controller/AccountRpcController.java
common/controller/UserRpcController.java
common/controller/BtseTransferRpcController.java
common/controller/ReconciliationRpcController.java

# ä¿®æ”¹å†…å®¹
- package com.binaryoption.common.rpc;
+ package com.binaryoption.common.controller;
```

**æ–¹æ¡ˆ B: ç§»åŠ¨æ–‡ä»¶åˆ°æ­£ç¡®ç›®å½•**

```bash
# åˆ›å»º rpc ç›®å½•å¹¶ç§»åŠ¨æ–‡ä»¶
mkdir -p common/rpc/
mv common/controller/*RpcController.java common/rpc/
```

**é¢„è®¡å½±å“**: ä½é£é™©ï¼Œéœ€è¦æ›´æ–°ç›¸å…³ import

---

## 6. é£é™©è¯„ä¼°

| æ“ä½œ | é£é™©çº§åˆ« | è¯´æ˜ |
|------|---------|------|
| æå– Redis é…ç½® | ä½ | åªæ˜¯ç§»åŠ¨æ–‡ä»¶ï¼Œä¸æ”¹å˜é€»è¾‘ |
| æå–çº¿ç¨‹æ± åŸºç±» | ä½ | æ–°å¢æŠ½è±¡ï¼Œä¸å½±å“ç°æœ‰ä»£ç  |
| æ¸…ç†ç©ºç›®å½• | æ—  | çº¯æ¸…ç†æ“ä½œ |
| åˆ é™¤æµ‹è¯•æ§åˆ¶å™¨ | æ—  | ä»…ç§»é™¤è°ƒè¯•ä»£ç  |
| ä¿®æ­£åŒ…å | ä½ | éœ€è¦æ›´æ–° importï¼Œä½†æ— é€»è¾‘å˜åŒ– |

---

## 7. æ€»ç»“ä¸å»ºè®®

### 7.1 æ ¸å¿ƒç»“è®º

ç»è¿‡åˆ†æï¼Œ`binary-option-app` ä¸­**çœŸæ­£å¯å…±äº«çš„ç»„ä»¶è¾ƒå°‘**ï¼Œä¸»è¦åŸå› ï¼š

1. **å·²æœ‰å…±äº«æ¨¡å—**: `option-common-utils` å’Œ `option-common-dto` å·²ç»æä¾›äº†å¤§éƒ¨åˆ†é€šç”¨åŠŸèƒ½
2. **ä¸šåŠ¡å·®å¼‚å¤§**: å„æ¨¡å—çš„é…ç½®ã€è½¬æ¢å™¨ã€æœåŠ¡éƒ½æœ‰ä¸šåŠ¡ç‰¹æ®Šæ€§
3. **åˆå¹¶å·²ä¼˜åŒ–**: ä¹‹å‰çš„åˆå¹¶å·¥ä½œå·²ç»æ¶ˆé™¤äº†å¤§éƒ¨åˆ†é‡å¤

### 7.2 å»ºè®®ä¼˜å…ˆçº§ (v1.2 æ›´æ–°)

| ä¼˜å…ˆçº§ | å»ºè®® | åŸå›  | çŠ¶æ€ |
|--------|------|------|------|
| **ç«‹å³æ‰§è¡Œ** | åˆ é™¤ç©ºç›®å½• | çº¯æ¸…ç†ï¼Œæ— é£é™© | âœ… å·²å®Œæˆ |
| **ç«‹å³æ‰§è¡Œ** | åˆ é™¤æµ‹è¯•æ§åˆ¶å™¨ | ç”Ÿäº§ç¯å¢ƒä¸éœ€è¦ | âœ… å·²å®Œæˆ |
| **ç«‹å³æ‰§è¡Œ** | ä¿®æ­£åŒ…åä¸ä¸€è‡´ | è¿å Java è§„èŒƒ | âœ… å·²å®Œæˆ (æ–¹æ¡ˆB) |
| **æ¨è** | æå– `RedisCacheConfig` åˆ° shared | Redis é…ç½®ç¡®å®æ˜¯é€šç”¨çš„ | âœ… å·²å®Œæˆ |
| **å¯é€‰** | æå– `ThreadPoolConfig` åŸºç±» | å¢åŠ ä»£ç å¤ç”¨ï¼Œä½†æ”¶ç›Šæœ‰é™ | å¾…è¯„ä¼° |
| **ä¸å»ºè®®** | å¤§è§„æ¨¡é‡æ„ | å½“å‰ç»“æ„å·²ç»åˆç† | - |

### 7.3 ç«‹å³æ¸…ç†ä»»åŠ¡æ¸…å•

```bash
# 1. åˆ é™¤ç©ºç›®å½•
rm -rf common/exception/
rm -rf order/exception/

# 2. åˆ é™¤æµ‹è¯•æ§åˆ¶å™¨
rm order/controller/SecurityTestController.java
rm order/controller/TestI18nController.java

# 3. ä¿®æ­£åŒ…å (é€‰æ‹©æ–¹æ¡ˆ A æˆ– B)
# æ–¹æ¡ˆ A: ä¿®æ”¹ package å£°æ˜ä¸º com.binaryoption.common.controller
# æ–¹æ¡ˆ B: åˆ›å»º common/rpc/ ç›®å½•å¹¶ç§»åŠ¨æ–‡ä»¶
```

### 7.4 æœ€ç»ˆå»ºè®®

**ç«‹å³æ‰§è¡Œæ¸…ç†ä»»åŠ¡**ï¼Œç„¶åè§†éœ€æ±‚å†³å®šæ˜¯å¦æå–å…±äº«æ¨¡å—ï¼š

1. âœ… åˆ é™¤ç©ºç›®å½• (`common/exception/`, `order/exception/`)
2. âœ… åˆ é™¤æµ‹è¯•æ§åˆ¶å™¨ (`SecurityTestController`, `TestI18nController`)
3. âœ… ä¿®æ­£åŒ…åä¸ä¸€è‡´ (RPC æ§åˆ¶å™¨ â†’ `common/rpc/`)
4. âœ… ç§»åŠ¨ `CacheConfig.java` â†’ `shared/config/RedisCacheConfig.java`

**åŸå› **: å½“å‰æ¨¡å—åˆ’åˆ†å·²ç»æ¯”è¾ƒæ¸…æ™°ï¼Œå„æ¨¡å—èŒè´£æ˜ç¡®ã€‚è¿‡åº¦æå–å…±äº«æ¨¡å—å¯èƒ½å¯¼è‡´ï¼š
- å¢åŠ ä»£ç è·³è½¬å¤æ‚åº¦
- å¼•å…¥ä¸å¿…è¦çš„æŠ½è±¡å±‚
- é™ä½ä»£ç å¯è¯»æ€§

---

## 8. å½“å‰å®Œæ•´æ–‡ä»¶ç»“æ„ (v1.2 æ›´æ–°)

```
binary-option-app/src/main/java/com/binaryoption/
â”œâ”€â”€ BinaryOptionApplication.java          # ä¸»å¯åŠ¨ç±» (å«UTCæ—¶åŒºè®¾ç½®)
â”‚
â”œâ”€â”€ shared/                               # âœ… æ–°å¢ï¼šå…±äº«æ¨¡å—
â”‚   â””â”€â”€ config/
â”‚       â””â”€â”€ RedisCacheConfig.java         # ç»Ÿä¸€Redisé…ç½®
â”‚
â”œâ”€â”€ common/                               # ç”¨æˆ·è´¦æˆ·æ¨¡å—
â”‚   â”œâ”€â”€ config/                           # 4ä¸ªé…ç½®ç±»
â”‚   â”‚   â”œâ”€â”€ BtseIntegrationConfig.java
â”‚   â”‚   â”œâ”€â”€ CommonServiceMyBatisConfig.java
â”‚   â”‚   â”œâ”€â”€ CommonServiceSecurityConfig.java
â”‚   â”‚   â””â”€â”€ CommonServiceSwaggerConfig.java
â”‚   â”œâ”€â”€ controller/                       # 3ä¸ªæ§åˆ¶å™¨ (ä¸šåŠ¡API)
â”‚   â”‚   â”œâ”€â”€ AccountController.java
â”‚   â”‚   â”œâ”€â”€ UserController.java
â”‚   â”‚   â””â”€â”€ UserTransferController.java
â”‚   â”œâ”€â”€ rpc/                              # âœ… æ–°å¢ï¼š4ä¸ªRPCæ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ AccountRpcController.java
â”‚   â”‚   â”œâ”€â”€ BtseTransferRpcController.java
â”‚   â”‚   â”œâ”€â”€ ReconciliationRpcController.java
â”‚   â”‚   â””â”€â”€ UserRpcController.java
â”‚   â”œâ”€â”€ converter/                        # 2ä¸ªè½¬æ¢å™¨
â”‚   â”œâ”€â”€ domain/                           # 6ä¸ªå®ä½“
â”‚   â”œâ”€â”€ integration/                      # 6ä¸ªBTSEé›†æˆç±»
â”‚   â”œâ”€â”€ mapper/                           # 5ä¸ªMapper
â”‚   â””â”€â”€ service/                          # 8ä¸ªæœåŠ¡
â”‚
â”œâ”€â”€ order/                                # è®¢å•äº¤æ˜“æ¨¡å—
â”‚   â”œâ”€â”€ cache/                            # 1ä¸ªç¼“å­˜æœåŠ¡
â”‚   â”‚   â””â”€â”€ HistoryPriceQueryService.java
â”‚   â”œâ”€â”€ config/                           # 2ä¸ªé…ç½®ç±» (CacheConfigå·²ç§»èµ°)
â”‚   â”‚   â”œâ”€â”€ OrderConfig.java
â”‚   â”‚   â””â”€â”€ SettlementExecutorConfig.java
â”‚   â”œâ”€â”€ controller/                       # 4ä¸ªæ§åˆ¶å™¨ (æµ‹è¯•æ§åˆ¶å™¨å·²åˆ é™¤)
â”‚   â”‚   â”œâ”€â”€ OrderController.java
â”‚   â”‚   â”œâ”€â”€ OrderRpcController.java
â”‚   â”‚   â”œâ”€â”€ PublicOrderController.java
â”‚   â”‚   â””â”€â”€ UserRoundRpcController.java
â”‚   â”œâ”€â”€ converter/                        # 2ä¸ªè½¬æ¢å™¨
â”‚   â”œâ”€â”€ domain/                           # 11ä¸ªå®ä½“
â”‚   â”œâ”€â”€ dto/                              # 4ä¸ªå†…éƒ¨DTO
â”‚   â”œâ”€â”€ mapper/                           # 11ä¸ªMapper
â”‚   â”œâ”€â”€ pricing/                          # å®šä»·å­æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ odds/                         # èµ”ç‡è®¡ç®— (å«JNI)
â”‚   â”‚   â”œâ”€â”€ task/                         # å®šæ—¶ä»»åŠ¡
â”‚   â”‚   â””â”€â”€ volatility/                   # æ³¢åŠ¨ç‡é¢„æµ‹ (å«JEP)
â”‚   â”œâ”€â”€ service/                          # 9ä¸ªæœåŠ¡
â”‚   â””â”€â”€ task/                             # 3ä¸ªå®šæ—¶ä»»åŠ¡
â”‚
â”œâ”€â”€ market/                               # è¡Œæƒ…æ•°æ®æ¨¡å—
â”‚   â”œâ”€â”€ cache/
â”‚   â”‚   â””â”€â”€ MarketCacheService.java
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â””â”€â”€ MarketWebSocketConfig.java
â”‚   â””â”€â”€ ws/
â”‚       â””â”€â”€ MarketWebSocketHandler.java
â”‚
â””â”€â”€ gateway/                              # ç½‘å…³æ¨¡å—
    â”œâ”€â”€ config/
    â”‚   â”œâ”€â”€ DemoRegisterProperties.java
    â”‚   â”œâ”€â”€ GatewayFilterConfig.java
    â”‚   â””â”€â”€ RateLimitProperties.java
    â”œâ”€â”€ filter/
    â”‚   â”œâ”€â”€ LocaleFilter.java             # è¯­è¨€æ£€æµ‹ (-200)
    â”‚   â”œâ”€â”€ OAuthTokenFilter.java         # OAuthè®¤è¯ (-150)
    â”‚   â”œâ”€â”€ RateLimitFilter.java          # é™æµ (-140)
    â”‚   â””â”€â”€ TraceIdFilter.java            # è¿½è¸ª (-130)
    â””â”€â”€ service/
        â””â”€â”€ RateLimitService.java
```

**v1.2 å˜æ›´ç»Ÿè®¡**:
- åˆ é™¤ç©ºç›®å½•: 2ä¸ª (`common/exception/`, `order/exception/`)
- åˆ é™¤æµ‹è¯•æ§åˆ¶å™¨: 2ä¸ª (`SecurityTestController`, `TestI18nController`)
- æ–°å¢ç›®å½•: 2ä¸ª (`shared/config/`, `common/rpc/`)
- ç§»åŠ¨æ–‡ä»¶: 5ä¸ª (4ä¸ªRPCæ§åˆ¶å™¨ + 1ä¸ªCacheConfig)
- æ€» Java æ–‡ä»¶: ~96 ä¸ª (å‡å°‘4ä¸ª)
- é…ç½®ç±»: 12 ä¸ª
- æ§åˆ¶å™¨: 11 ä¸ª
- æœåŠ¡ç±»: 18+ ä¸ª
- Mapper: 16 ä¸ª

---

## 9. æ›´æ–°æ—¥å¿—

### v1.2 (2025-12-30)
- **æ¸…ç†ä»»åŠ¡å…¨éƒ¨å®Œæˆ**
- æ‰§è¡Œæ–¹æ¡ˆ B: åˆ›å»º `common/rpc/` ç›®å½•ï¼Œç§»åŠ¨4ä¸ªRPCæ§åˆ¶å™¨
- åˆ›å»º `shared/config/` ç›®å½•ï¼Œç§»åŠ¨ `CacheConfig` â†’ `RedisCacheConfig`
- åˆ é™¤ç©ºç›®å½•: `common/exception/`, `order/exception/`
- åˆ é™¤æµ‹è¯•æ§åˆ¶å™¨: `SecurityTestController`, `TestI18nController`
- ç¼–è¯‘éªŒè¯é€šè¿‡
- æ›´æ–°æ–‡ä»¶ç»“æ„å›¾

### v1.1 (2025-12-30)
- **æ·±åº¦åˆ†æå®Œæˆ**
- æ–°å¢ Section 2.5: å‘ç°çš„é—®é¢˜
  - åŒ…åä¸ä¸€è‡´: 4ä¸ªRPCæ§åˆ¶å™¨åŒ…åä¸ç›®å½•ä¸åŒ¹é…
  - æµ‹è¯•æ§åˆ¶å™¨æ®‹ç•™: 2ä¸ªè°ƒè¯•ç”¨æ§åˆ¶å™¨
  - ç©ºç›®å½•æ®‹ç•™: 2ä¸ªç©ºçš„exceptionç›®å½•
  - æœ¬åœ°DTOåˆ†æ: ç¡®è®¤4ä¸ªDTOä»…å†…éƒ¨ä½¿ç”¨
- æ–°å¢ Section 5.4-5.5: æ¸…ç†ä»»åŠ¡æ­¥éª¤
- æ–°å¢ Section 8: å®Œæ•´æ–‡ä»¶ç»“æ„å›¾
- æ›´æ–°é£é™©è¯„ä¼°è¡¨
- æ›´æ–°å»ºè®®ä¼˜å…ˆçº§å’Œä»»åŠ¡æ¸…å•

### v1.0 (2025-12-30)
- åˆå§‹æ–¹æ¡ˆè®¾è®¡
- åˆ†æå„æ¨¡å—ç»„ä»¶çš„å¯å…±äº«æ€§
- æå‡º shared æ¨¡å—ç»“æ„å»ºè®®
- ç»™å‡ºå®æ–½æ­¥éª¤å’Œé£é™©è¯„ä¼°
